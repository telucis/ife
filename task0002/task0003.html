<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="initial-scale=1,maximum-scale=3,minimum-scale=1,user-scalable=no">
	<meta name="description" content="This is a system of the task management.">
	<meta name="telucis" content="telucis@126.com">
	<title>task 3</title>
	<style>
		html{height:100%}
		body{height:100%}
		body,div,ul,li,img,a,p,header,aside,section,article,footer{padding: 0;margin: 0;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;}
		body{font-family: '微软雅黑'}
		.manage,.manage footer,.main aside,.main header,.main footer{border-right:1px solid #ccc;border-bottom: 1px solid #ccc;}
		.head{width: 100%;background: #ddd;min-height: 60px;color: #8F8F8F;line-height: 60px;padding-left: 20px;z-index: 1;
			}
		.manage{width: 200px;padding-left: 30px;float: left;overflow: auto;
			background: #F2F2F2;font-size: 15px;line-height: 25px;}
		.manage ul li{cursor: pointer;padding-right: 20px;height: 40px;line-height: 40px;}
		.manage ul li .del{float: right;display: none;font-size: 20px;}
		.manage ul li .del:hover{color: #fff;}
		.manage ul li:hover{background: #ddd;}
		.manage ul li:hover .del{display: block;z-index: 10;}
		.manage ul li.active{background: #ddd;}
		.manage footer{position: fixed;left: 0;bottom: 0;height: 60px;padding-left: 20px;
			line-height: 60px;background: #eee;width: 200px;border-top: 1px solid #ccc;z-index: 1;}
		.manage footer span{cursor: pointer;margin-right: 20px;}
		.main{float:left;position: relative;}
		.main aside{width: 200px;height: 100%;float: left;}
		.main aside header{position: absolute;height: 60px;width: 200px;background:#eee;line-height: 60px; }
		.main aside header span{cursor: pointer;font-size: 14px;margin-left: 15px;border: 1px solid #ccc;border-radius: 5px;padding: 2px;}
		.main aside header span.active{background: #fff;}
		.main aside div{width: 200px;height: 100%;padding: 60px 0 60px 0;overflow: auto;}
		.main aside div ul{display: none;}
		.main aside div ul.active{display: block;}
		.main section{height: 100%;float: left;}
		.main aside footer{position: fixed;bottom: 0;height: 60px;width: 200px;background:#eee;border-top: 1px solid #ccc; padding-left: 20px;line-height: 60px;}
		.main aside footer span{cursor: pointer;}
		.popup{position: absolute;top: 0;left: 0;height: 100%;width: 100%;background: #000;opacity: 0.3;z-index: 10;display: none;}
		.popup div{position: absolute;top: 50%;left: 50%;height: 300px;width: 400px;margin-left: -200px;margin-top: -150px;background: #fff;border-radius: 10px;padding: 40px;font-size: 20px;}
		.popup div #newclass,.popup div #newtask{width: 300px;height: 50px;line-height: 50px;font-size: 30px;margin: 10px 0 30px 0;border-radius: 10px;}
		.popup div .btn{width: 100px;height: 40px;border-radius: 10px;float: right;margin-right: 10px;cursor: pointer;background: #c8c;font-size: 20px;font-family: '微软雅黑'}
		.popup div .btn:hover{background: #a6a;}
		.popup div .exit{position: absolute;right: 20px;top: 10px;font-size: 30px;cursor: pointer;}
		.popup div .exit:hover{color: #c00;}
	</style>
	<script src="js/task0003_style.js"></script>
	<script>
		window.onload=function(){
			var addclass=document.getElementById('addclass');
			var addtask=document.getElementById('addtask');
			var clearclass=document.getElementById('clearclass');
			var popup=document.getElementsByClassName('popup');
			var exit=document.getElementsByClassName('exit');
			var afirm=document.getElementsByClassName('afirm');
			var cancel=document.getElementsByClassName('cancel');
			var newclass=document.getElementById('newclass');
			var newtask=document.getElementById('newtask');
			//动态CSS
			subStyle();
			//验证分类唯一性
			function unique(arr){
				var temp=[];
				for(var i=0;i<arr.length;i++){
					var flag=true;
					for(var j=0;j<temp.length;j++){
						if(temp[j]==arr[i]){
							flag=false;
							continue;
						}
					}
					arr[i] && flag==true && temp.push(arr[i]);
				}
				return temp;
			}
			//本地存储保存分类
			if(localStorage.newclass){
				var storage=unique(localStorage.newclass.split(/\|/));
				for(var i=0;i<storage.length;i++){
					var storageLi=document.createElement('li');
					storageLi.innerHTML=storage[i]+'<span class="del">×</span>';
					document.getElementsByTagName('ul')[0].appendChild(storageLi);
					storageLi.getElementsByTagName('span')[0].addEventListener('click',mydel,false);
				}
			}else{localStorage.newclass='';}
			
			//弹出层效果
			addclass.onclick=function(){
				popup[0].style.display="block";
				newclass.focus();
			}
			addtask.onclick=function(){
				popup[1].style.display="block";
			}
			clearclass.addEventListener('click',add_class,false)

			function add_class(){
				if(confirm("删除全部分类？")){
					for(var i=mylist.length-1;i>0;i--){
						mylist[i].remove();
					}
					localStorage.newclass='';	
				}
			}
			
			for(var i=0;i<exit.length;i++){
				exit[i].index=i;
				exit[i].onclick=function(){
					popup[this.index].style.display='none';
				}
			}
			for(var i=0;i<cancel.length;i++){
				cancel[i].index=i;
				cancel[i].onclick=function(){
					popup[this.index].style.display='none';
				}
			}
			//添加分类
			afirm[0].onclick=function(){				
				for(var i=0;i<mylist.length;i++){
					if(newclass.value==mylist[i].innerHTML){
						alert('这个分类已存在，换一个吧！');
						newclass.value='';
						return false;
					}
				}
				var oli=document.createElement('li');
				oli.innerHTML=newclass.value+'<span class="del">×</span>';
				document.getElementsByTagName('ul')[0].appendChild(oli);
				popup[0].style.display='none';
				localStorage.newclass=localStorage.newclass+newclass.value+'|';
				mylist=document.getElementsByClassName('manage')[0].getElementsByTagName('li');
				oli.addEventListener('click',mylistFouce,false);
				oli.getElementsByTagName('span')[0].addEventListener('click',mydel,false);
				//添加任务栏
				var oul=document.createElement('ul');
				oul.setAttribute('id',newclass.value);
				document.getElementsByClassName('main')[0].getElementsByTagName('div')[0].appendChild(oul);

				newclass.value='';
			}

			//管理栏效果
			var mylist=document.getElementsByClassName('manage')[0].getElementsByTagName('li');
			function mydel(){
				var mydel_string=this.parentNode.innerHTML.replace(/\<span class\=\"del\"\>×\<\/span\>/,'');
				this.parentNode.remove();
				localStorage.newclass=localStorage.newclass.replace(eval('/'+mydel_string+'\|/g'),'');
				console.log(localStorage.newclass);
				console.log(mydel_string);
				document.getElementById(mydel_string).remove();
			}
			function mylistFouce(){
				for(var j in mylist){mylist[j].className=''}
				this.className='active';
				
			}
			for(var i=0;i<mylist.length;i++){
				mylist[i].addEventListener('click',mylistFouce,false);				
			}
			 
			//添加任务
			afirm[1].addEventListener('click',add_task,false);
			function add_task(){
				var date_task=new Date();
				var oli=document.createElement('li');
				oli.innerHTML=newtask.value;
				document.getElementsByClassName('main')[0].getElementsByTagName('ul')[0].appendChild(oli);

			}
		}
	</script>
</head>
<body>
	<header class='head'>GTD Tools</header>
	<aside class='manage'>
		<span>所有任务</span>
		<ul>分类列表
			<li class="active">默认分类</li>
		</ul>
		<footer><span id='addclass'>新增分类</span><span id='clearclass'>清除分类</span></footer>
	</aside>
	<article class='main'>
		<aside>
			<header><span class='active'>所有</span><span>未完成</span><span>已完成</span></header>
			<div></div>
			<footer><span id='addtask'>新增任务</span></footer>
		</aside>
		<section class='detail'></section>
	</article>
	<div class="popup">
		<div>
			<p>新增分类</p><hr>
			<p>分类标题</p>
			<input type="text" id='newclass'><br>
			<button class="btn cancel">取消</button><button class="btn afirm">确定</button>
			<span class="exit">×</span>
		</div>
	</div>
	<div class="popup">
		<div>
			<p>新增任务</p><hr>
			<p>任务标题</p>
			<input type="text" id='newtask'><br>
			<button class="btn cancel">取消</button><button class="btn afirm">确定</button>
			<span class="exit">×</span>
		</div>
	</div>
</body> 
</html>